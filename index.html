<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Jarvis IA Espacial</title>
<style>
  html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;font-family:sans-serif;color:#fff}
  canvas{position:absolute;top:0;left:0;z-index:0}
  #ui{position:absolute;top:10px;left:10px;z-index:1;width:95%;max-width:600px}
  #chat{display:flex;flex-direction:column-reverse;gap:6px;max-height:60vh;overflow-y:auto;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px}
  .msg{padding:8px;border-radius:6px;max-width:80%}
  .user{align-self:flex-end;background:linear-gradient(90deg,#2b6bff,#66ccff);color:#001}
  .bot{align-self:flex-start;background:#071c27;border:1px solid rgba(255,255,255,0.1)}
  #inputArea{display:flex;margin-top:6px}
  #msgInput{flex:1;padding:10px;border-radius:6px;border:none;background:#111;color:#fff;outline:none}
  #sendBtn{padding:10px;border-radius:6px;border:none;background:#66ccff;color:#001;cursor:pointer;font-weight:700;margin-left:4px}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div id="ui">
  <div id="chat"></div>
  <div id="inputArea">
    <input id="msgInput" placeholder="Digite algo..." />
    <button id="sendBtn">Enviar</button>
  </div>
</div>

<script>
// --- Canvas fundo espacial ---
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;
window.addEventListener('resize',()=>{W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight;});

// partículas estilo estrelas
const stars = [];
for(let i=0;i<300;i++){
  stars.push({x:Math.random()*W, y:Math.random()*H, r:Math.random()*1.5+0.5, dx:(Math.random()-0.5)*0.2, dy:(Math.random()-0.5)*0.2});
}

// --- Sprites Pokémon ---
const sprites = [];
const NUM_POKEMON = 15;
async function loadPokemonSprites(){
  for(let i=1;i<=NUM_POKEMON;i++){
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${i}`);
    const data = await res.json();
    const img = new Image();
    img.src = data.sprites.front_default;
    sprites.push({img,x:Math.random()*W,y:Math.random()*H,dx:(Math.random()-0.5)*2,dy:(Math.random()-0.5)*2});
  }
}
loadPokemonSprites();

// --- Chat IA simples com aprendizado ---
const chat = document.getElementById('chat');
const input = document.getElementById('msgInput');
const sendBtn = document.getElementById('sendBtn');

// memória local da IA
let memory = JSON.parse(localStorage.getItem('jarvisMemory')||'{}');

function saveMemory(){ localStorage.setItem('jarvisMemory',JSON.stringify(memory)); }

function appendMessage(msg,type){
  const div = document.createElement('div'); div.className='msg '+type; div.textContent=msg;
  chat.prepend(div);
}

// função principal de IA: busca resposta ou aprende
function getResponse(text){
  text=text.toLowerCase();
  // se já aprendeu algo parecido
  for(const key in memory){
    if(text.includes(key)) return memory[key];
  }
  // fallback
  return "Ainda não sei sobre isso, me ensine!";
}

function learnResponse(userInput, botReply){
  memory[userInput.toLowerCase()] = botReply;
  saveMemory();
}

// evento enviar
sendBtn.addEventListener('click',()=>{sendMessage();});
input.addEventListener('keydown',e=>{if(e.key==='Enter'){sendMessage();}});

function sendMessage(){
  const txt=input.value.trim();
  if(!txt) return;
  appendMessage(txt,'user');
  input.value='';
  
  let reply = getResponse(txt);
  appendMessage(reply,'bot');

  // se bot não sabe, esperar usuário ensinar
  if(reply.includes("Ainda não sei")){
    const userTeach = prompt("Como eu devo responder a '"+txt+"'?");
    if(userTeach){
      learnResponse(txt,userTeach);
      appendMessage("Obrigado! Aprendi isso.","bot");
    }
  }
}

// --- animação do fundo ---
function animate(){
  ctx.fillStyle='black';
  ctx.fillRect(0,0,W,H);

  // estrelas
  ctx.fillStyle='white';
  for(const s of stars){
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0)s.x=W;if(s.x>W)s.x=0;
    if(s.y<0)s.y=H;if(s.y>H)s.y=0;
    ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
  }

  // pokemons
  for(const p of sprites){
    if(!p.img.complete) continue;
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0)p.x=W;if(p.x>W)p.x=0;
    if(p.y<0)p.y=H;if(p.y>H)p.y=0;
    ctx.drawImage(p.img,p.x,p.y,32,32);
  }

  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
